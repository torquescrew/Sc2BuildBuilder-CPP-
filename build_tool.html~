<!DOCTYPE html>
<html>
  <!--
   Copyright (c) 2011 The Chromium Authors. All rights reserved.
   Use of this source code is governed by a BSD-style license that can be
   found in the LICENSE file.
   -->
  <head>
    <title>Build Tool</title>
    
    <script type="text/javascript">
      var kMaxArraySize = 20;
      var messageArray = new Array();
      var eventModule = null;
      
      function $(id) {
        return document.getElementById(id);
      }
      
      // Indicate success when the NaCl module has loaded.
      function moduleDidLoad() {
        eventModule = document.getElementById('event_module');
      }
      
      function receiveMessage(message) {
        // Show last |kMaxArraySize| events in html.
        messageArray.push(message.data);
        if (messageArray.length > kMaxArraySize) {
          messageArray.shift();
        }
        var newData = messageArray.join('<BR>');
        document.getElementById('eventString').innerHTML = newData;
        // Print event to console.
        console.log(message.data);
      }
      function cancelQueue() {
        if (eventModule == null) {
          console.log('Module is not loaded.');
          return;
        }
        eventModule.postMessage('CANCEL');
      }
      function startBT() {
        if (eventModule == null) {
          console.log('Module is not loaded.');
          return;
        }
        eventModule.postMessage('START');
      }
      </script>
  </head>
  <body>
    <h1>Sc2 Build Tool</h1>
    <div id="listener">
      <script type="text/javascript">
        $('listener').addEventListener('message', receiveMessage, true);
        $('listener').addEventListener('load', moduleDidLoad, true);
        </script>
      <button onclick="startBT()">Start build tool</button>
      <button onclick="cancelQueue()">Stop</button>
      <p/>
      <embed name="nacl_module"
      id="event_module"
      width=0 height=0
      src="mt_input_events.nmf"
      type="application/x-nacl"
      style="background-color:gray" />
    </div>
    <pre><p><b id='eventString'></b></p>
    </pre>
  </body>
</html>
